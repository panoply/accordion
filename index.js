function y(t){return{on:(e,i)=>{t[e]||(t[e]=[]),t[e].push(i)},off:(e,i)=>{let c=[],n=t[e];if(n&&i){let s=0,u=n.length;for(;s<u;s++)n[s]!==i&&c.push(n[s])}c.length?n[e]=c:delete n[e]},emit:(e,i,c)=>{let n=t[e]||[],s=n.length,u=null;for(let m=0;m<s;m++){let p=n[m].apply(i,[c]);u===null&&p===!1&&(u=!0)}return u}}}function E(t,d){let{config:l}=t,{classes:f}=l;return e=>{let i=n=>{if(typeof n!="number")return t.active!==e.index&&(t.active=e.index),e;if(t.folds[n])return t.active=e.index,t.folds[n];throw new TypeError(`No fold exists at index: ${n}`)},c=n=>{n.button.ariaDisabled="false",n.button.ariaExpanded="false",n.button.classList.remove(f.opened),n.content.classList.remove(f.expanded),n.expanded=!1,n.content.style.maxHeight="0"};e.open=n=>{let s=i(n);s.expanded||(s.close(),s.button.ariaDisabled="true",s.button.ariaExpanded="true",s.button.classList.add(f.opened),s.content.classList.add(f.expanded),s.content.style.maxHeight=`${s.content.scrollHeight}px`,s.expanded=!0,s.disable(),t.count=t.folds.filter(({expanded:u})=>u).length,d.emit("expand",t,s))},e.close=n=>{let s=i(n);if(l.multiple)(!l.persist||l.persist&&t.count>1)&&c(s);else for(let u of t.folds)if(u.expanded){if(l.persist&&u.index===s.index)break;c(u),s=u;break}s.enable(),t.count=t.folds.filter(({expanded:u})=>u).length,d.emit("collapse",t,s)},e.focus=()=>{t.active=e.index,e.button.classList.add(f.focused),d.emit("focus",t,e)},e.blur=()=>e.button.classList.remove(f.focused),e.enable=n=>{let s=i(n);s.disabled&&(s.disabled=!1,s.button.ariaDisabled="false",s.button.classList.remove(f.disabled))},e.disable=n=>{let s=i(n);s.disabled||(s.expanded?l.persist&&(s.disabled=!0,s.button.ariaDisabled="true"):(s.close(),s.disabled=!0,s.button.ariaDisabled="true",s.button.classList.add(f.disabled)))},e.toggle=()=>{if(!d.emit("toggle",t,e))return e.expanded?e.close():e.open()},e.destroy=(n=!1)=>{e.close(),e.button.removeEventListener("click",e.toggle),e.button.removeEventListener("focus",e.focus),e.button.removeEventListener("blur",e.blur),n&&(t.element.removeChild(e.content),t.element.removeChild(e.button))},e.button.addEventListener("click",e.toggle),e.button.addEventListener("focus",e.focus),e.button.addEventListener("blur",e.blur),t.folds.push(e)}}var $=t=>{let d=t.trim();if(!/true|false/.test(d))throw new TypeError(`Invalid value. Boolean expected, received: ${d}`);return d==="true"},A=(t,d)=>{let l=Object.create(null);if(l.classes=Object.create(null),l.persist=!0,l.multiple=!1,l.schema="data-relapse",l.classes.initial="initial",l.classes.opened="opened",l.classes.disabled="disabled",l.classes.expanded="expanded",l.classes.focused="focused",typeof t=="object")for(let i in t)if(i==="classes")for(let c in t[i])l.classes[c]=t[i][c];else l[i]=t[i];let f=/^(?:persist|multiple)$/,e=l.schema===null?5:l.schema.length+1;for(let{nodeName:i,nodeValue:c}of d){let n=i.slice(e);f.test(n)&&(l[n]=$(c))}return l},w=function t(d,l){let f;if(typeof d=="string")if(d.charCodeAt(0)===35)f=document.body.querySelector(d);else for(let o of document.body.querySelectorAll(d))t(o,l);else if(d instanceof NodeList)for(let o of d)t(o,l);else d instanceof Element&&(f=d);if(!f)return;window.relapse instanceof Map||(window.relapse=new Map);let e=Object.create(null);e.events={},e.folds=[],e.element=f,e.id=`A${window.relapse.size}`,e.count=0,e.config=A(l,e.element.attributes);let i;e.element.hasAttribute("data-relapse")?i=e.element.getAttribute("data-relapse"):(i=Math.random().toString(36).slice(2),e.element.setAttribute("data-relapse",i));let c=e.element.getAttribute("id");if(i===null&&c===null)i=e.id;else if(i!==null&&c!==null){if(window.relapse.has(c)||window.relapse.has(i))throw new TypeError(`An existing instance is using id "${i}"`)}else i===null&&c!==null&&(i=c);if(window.relapse.has(i))throw new TypeError(`An existing instance is using id "${i}"`);e.element.ariaMultiSelectable=`${e.config.multiple}`;let n=e.element.children,s=n.length,u=y(e.events),m=E(e,u),{classes:p}=e.config;for(let o=0;o<s;o=o+2){let a=n[o],b=n[o+1],r=Object.create(null);r.index=e.folds.length;let v=a.classList.contains(p.initial),h=a.classList.contains(p.opened),x=a.classList.contains(p.disabled),L=b.classList.contains(p.expanded);a.ariaExpanded==="true"||h||L||v?(h?a.ariaExpanded="true":a.classList.add(p.opened),L||b.classList.add(p.expanded),x||a.classList.add(p.disabled),v||a.classList.remove(p.initial),a.ariaDisabled="true",r.expanded=!0,r.disabled=!0):a.ariaDisabled==="true"||x?(x?a.ariaDisabled="false":a.classList.add(p.disabled),b.classList.remove(p.expanded),a.classList.remove(p.opened),a.ariaExpanded="false",r.expanded=!1,r.disabled=!0):(r.expanded=!1,r.disabled=!1,a.ariaExpanded="false",a.ariaDisabled="false"),a.id&&(r.id=a.id),b.id&&(r.id=b.id),"id"in r||(r.id=`${e.id}F${r.index}`,a.id=`B${r.id}`,b.id=`C${r.id}`),a.setAttribute("aria-controls",r.id),b.setAttribute("aria-labelledby",a.id),b.setAttribute("role","region"),r.button=a,r.content=b,r.expanded&&(e.count=e.count+1,r.content.style.maxHeight=`${r.content.scrollHeight}px`),m(r)}let g=(o,a,b=!1)=>{if(typeof a=="number")return o.charCodeAt(0)===100?e.folds[a][o](b):e.folds[a][o]();if(typeof a=="string"){for(let r of e.folds)if(r.button.dataset[`${e.config.schema}-fold`]===a)return o.charCodeAt(0)===100?r[o](b):r[o]()}throw new TypeError(`Fold does not exist: "${a}"`)};return e.on=u.on,e.off=u.off,e.collapse=o=>g("close",o),e.expand=o=>g("open",o),e.destroy=(o,a=!1)=>{if(typeof o=="undefined")for(let b of e.folds)b.destroy();else g("destroy",o,a);e.element.removeAttribute("aria-multiselectable"),u.emit("destroy",e),window.relapse.delete(i)},window.relapse.set(i,e),e};w.get=t=>t?window.relapse.get(t):window.relapse;var M=w;export{M as default};
