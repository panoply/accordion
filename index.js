function w(s){return{on:(e,o)=>{s[e]||(s[e]=[]),s[e].push(o)},off:(e,o)=>{let f=[],i=s[e];if(i&&o){let n=0,u=i.length;for(;n<u;n++)i[n]!==o&&f.push(i[n])}f.length?i[e]=f:delete i[e]},emit:(e,o,f)=>{let i=s[e]||[],n=i.length,u=null;for(let b=0;b<n;b++){let m=i[b].apply(o,[f]);u===null&&m===!1&&(u=!0)}return u}}}function L(s,c){let{config:r}=s,{classes:t}=r;return e=>{let o=i=>{if(typeof i!="number")return s.active!==e.number&&(s.active=e.number),e;if(s.folds[i])return s.active=e.number,s.folds[i];throw new TypeError(`No fold exists at index: ${i}`)},f=i=>{i.button.ariaDisabled="false",i.button.ariaExpanded="false",i.button.classList.remove(t.opened),i.content.classList.remove(t.expanded),i.expanded=!1,i.content.style.maxHeight="0"};e.open=i=>{let n=o(i);n.expanded||(n.close(),n.button.ariaDisabled="true",n.button.ariaExpanded="true",n.button.classList.add(t.opened),n.content.classList.add(t.expanded),n.content.style.maxHeight=`${n.content.scrollHeight}px`,n.expanded=!0,n.disable(),s.count=s.folds.filter(({expanded:u})=>u).length,c.emit("expand",s,n))},e.close=i=>{let n=o(i);if(r.multiple)(!r.persist||r.persist&&s.count>1)&&f(n);else for(let u of s.folds)if(u.expanded){if(r.persist&&u.number===n.number)break;f(u),n=u;break}n.enable(),s.count=s.folds.filter(({expanded:u})=>u).length,c.emit("collapse",s,n)},e.focus=()=>{s.active=e.number,e.button.classList.add(t.focused),c.emit("focus",s,e)},e.blur=()=>e.button.classList.remove(t.focused),e.enable=i=>{let n=o(i);n.disabled&&(n.disabled=!1,n.button.ariaDisabled="false",n.button.classList.remove(t.disabled))},e.disable=i=>{let n=o(i);n.disabled||(n.expanded?r.persist&&(n.disabled=!0,n.button.ariaDisabled="true"):(n.close(),n.disabled=!0,n.button.ariaDisabled="true",n.button.classList.add(t.disabled)))},e.toggle=()=>{if(!c.emit("toggle",s,e))return e.expanded?e.close():e.open()},e.destroy=(i=!1)=>{e.close(),e.button.removeEventListener("click",e.toggle),e.button.removeEventListener("focus",e.focus),e.button.removeEventListener("blur",e.blur),i&&(s.element.removeChild(e.content),s.element.removeChild(e.button))},e.button.addEventListener("click",e.toggle),e.button.addEventListener("focus",e.focus),e.button.addEventListener("blur",e.blur),s.folds.push(e)}}var E=s=>{let c=s.trim();if(!/true|false/.test(c))throw new TypeError(`Invalid value. Boolean expected, received: ${c}`);return c==="true"},$=(s,c)=>{typeof s!="object"&&(s=Object.create(null));let r=Object.create(null),t=Object.create(null);t.initial="initial",t.opened="opened",t.disabled="disabled",t.expanded="expanded",t.focused="focused","classes"in s&&Object.assign(t,s.classes),r.classes=t,r.persist=!0,r.multiple=!1,r.schema="data-relapse",typeof s=="object"&&Object.assign(r,s);let e=/^(?:persist|multiple)$/,o=r.schema===null?5:r.schema.length+1;for(let{nodeName:f,nodeValue:i}of c){let n=f.slice(o);e.test(n)&&(r[n]=E(i))}return r};function g(s,c){let r=typeof s=="string"?document.body.querySelector(s):s;if(!r)return;window.relapse instanceof Map||(window.relapse=new Map);let t=Object.create(null);t.folds=[],t.events=Object.create(null),t.element=r,t.id=`A${window.relapse.size}`,t.count=0,t.config=$(c,t.element.attributes);let e=t.element.getAttribute("data-relapse"),o=t.element.getAttribute("id");if(e===null&&o===null)e=t.id;else if(e!==null&&o!==null){if(window.relapse.has(o)||window.relapse.has(e))throw new TypeError(`An existing instance is using id "${e}"`)}else e===null&&o!==null&&(e=o);if(window.relapse.has(e))throw new TypeError(`An existing instance is using id "${e}"`);t.element.ariaMultiSelectable=`${t.config.multiple}`;let f=t.element.children,i=f.length,n=w(t.events),u=L(t,n),{classes:b}=t.config;for(let d=0;d<i;d=d+2){let a=f[d],p=f[d+1],l=Object.create(null);l.number=t.folds.length;let x=a.classList.contains(b.initial),y=a.classList.contains(b.opened),v=a.classList.contains(b.disabled),h=p.classList.contains(b.expanded);a.ariaExpanded==="true"||y||h||x?(y?a.ariaExpanded="true":a.classList.add(b.opened),h||p.classList.add(b.expanded),v||a.classList.add(b.disabled),x||a.classList.remove(b.initial),a.ariaDisabled="true",l.expanded=!0,l.disabled=!0):a.ariaDisabled==="true"||v?(v?a.ariaDisabled="false":a.classList.add(b.disabled),p.classList.remove(b.expanded),a.classList.remove(b.opened),a.ariaExpanded="false",l.expanded=!1,l.disabled=!0):(l.expanded=!1,l.disabled=!1,a.ariaExpanded="false",a.ariaDisabled="false"),a.id&&(l.id=a.id),p.id&&(l.id=p.id),"id"in l||(l.id=`${t.id}F${l.number}`,a.id=`B${l.id}`,p.id=`C${l.id}`),a.setAttribute("aria-controls",l.id),p.setAttribute("aria-labelledby",a.id),p.setAttribute("role","region"),l.button=a,l.content=p,l.expanded&&(t.count=t.count+1,l.content.style.maxHeight=`${l.content.scrollHeight}px`),u(l)}let m=(d,a,p=!1)=>{if(typeof a=="number")return d.charCodeAt(0)===100?t.folds[a][d](p):t.folds[a][d]();if(typeof a=="string"){for(let l of t.folds)if(l.button.dataset[`${t.config.schema}-fold`]===a)return d.charCodeAt(0)===100?l[d](p):l[d]()}throw new TypeError(`Fold does not exist: "${a}"`)};return t.on=n.on,t.off=n.off,t.collapse=d=>m("close",d),t.expand=d=>m("open",d),t.destroy=(d,a=!1)=>{if(typeof d=="undefined")for(let p of t.folds)p.destroy();else m("destroy",d,a);t.element.removeAttribute("aria-multiselectable"),n.emit("destroy",t),window.relapse.delete(e)},window.relapse.set(e,t),t}g.get=s=>s?window.relapse.get(s):window.relapse;g.load=()=>{document.readyState==="loading"&&setTimeout(g.load,50);let s=document.querySelectorAll("[data-relapse]");for(let c of s)c.getAttribute("data-relapse")!==""&&g(c)};var O=g;export{w as $events,O as default};
