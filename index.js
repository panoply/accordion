function y(n){return{on:(e,r)=>{n[e]||(n[e]=[]),n[e].push(r)},off:(e,r)=>{let c=[],i=n[e];if(i&&r){let s=0,u=i.length;for(;s<u;s++)i[s]!==r&&c.push(i[s])}c.length?i[e]=c:delete i[e]},emit:(e,r,c)=>{let i=n[e]||[],s=i.length,u=null;for(let f=0;f<s;f++){let m=i[f].apply(r,[c]);u===null&&m===!1&&(u=!0)}return u}}}function L(n,p){let{config:l}=n,{classes:t}=l;return e=>{let r=i=>{if(typeof i!="number")return n.active!==e.idx&&(n.active=e.idx),e;if(n.folds[i])return n.active=e.idx,n.folds[i];throw new TypeError(`No fold exists at index: ${i}`)},c=i=>{i.btn.ariaDisabled="false",i.btn.ariaExpanded="false",i.btn.classList.remove(t.opened),i.el.classList.remove(t.expanded),i.expanded=!1,i.el.style.maxHeight="0"};e.open=i=>{let s=r(i);s.expanded||(s.close(),s.btn.ariaDisabled="true",s.btn.ariaExpanded="true",s.btn.classList.add(t.opened),s.el.classList.add(t.expanded),s.el.style.maxHeight=`${s.el.scrollHeight}px`,s.expanded=!0,s.disable(),n.count=n.folds.filter(({expanded:u})=>u).length,p.emit("expand",n,s))},e.close=i=>{let s=r(i);if(l.multiple)(!l.persist||l.persist&&n.count>1)&&c(s);else for(let u of n.folds)if(u.expanded){if(l.persist&&u.idx===s.idx)break;c(u),s=u;break}s.enable(),n.count=n.folds.filter(({expanded:u})=>u).length,p.emit("collapse",n,s)},e.focus=()=>{n.active=e.idx,e.btn.classList.add(t.focused),p.emit("focus",n,e)},e.blur=()=>e.btn.classList.remove(t.focused),e.enable=i=>{let s=r(i);s.disabled&&(s.disabled=!1,s.btn.ariaDisabled="false",s.btn.classList.remove(t.disabled))},e.disable=i=>{let s=r(i);s.disabled||(s.expanded?l.persist&&(s.disabled=!0,s.btn.ariaDisabled="true"):(s.close(),s.disabled=!0,s.btn.ariaDisabled="true",s.btn.classList.add(t.disabled)))},e.toggle=()=>{if(!p.emit("toggle",n,e))return e.expanded?e.close():e.open()},e.destroy=(i=!1)=>{e.close(),e.btn.removeEventListener("click",e.toggle),e.btn.removeEventListener("focus",e.focus),e.btn.removeEventListener("blur",e.blur),i&&(n.element.removeChild(e.el),n.element.removeChild(e.btn))},e.btn.addEventListener("click",e.toggle),e.btn.addEventListener("focus",e.focus),e.btn.addEventListener("blur",e.blur),n.folds.push(e)}}var E=n=>{let p=n.trim();if(!/true|false/.test(p))throw new TypeError(`Invalid value. Boolean expected, received: ${p}`);return p==="true"},$=(n,p)=>{let l=Object.create(null);if(l.classes=Object.create(null),l.persist=!0,l.multiple=!1,l.schema="data-relapse",l.classes.initial="initial",l.classes.opened="opened",l.classes.disabled="disabled",l.classes.expanded="expanded",l.classes.focused="focused",typeof n=="object")for(let r in n)if(r==="classes")for(let c in n[r])l.classes[c]=n[r][c];else l[r]=n[r];let t=/^(?:persist|multiple)$/,e=l.schema===null?5:l.schema.length+1;for(let{nodeName:r,nodeValue:c}of p){let i=r.slice(e);t.test(i)&&(l[i]=E(c))}return l};function w(n,p){let l=typeof n=="string"?document.body.querySelector(n):n;if(!l)return;window.relapse instanceof Map||(window.relapse=new Map);let t=Object.create(null);t.folds=[],t.events=Object.create(null),t.element=l,t.id=`A${window.relapse.size}`,t.count=0,t.config=$(p,t.element.attributes);let e=t.element.getAttribute("data-relapse"),r=t.element.getAttribute("id");if(e===null&&r===null)e=t.id;else if(e!==null&&r!==null){if(window.relapse.has(r)||window.relapse.has(e))throw new TypeError(`An existing instance is using id "${e}"`)}else e===null&&r!==null&&(e=r);if(window.relapse.has(e))throw new TypeError(`An existing instance is using id "${e}"`);t.element.ariaMultiSelectable=`${t.config.multiple}`;let c=t.element.children,i=c.length,s=y(t.events),u=L(t,s),{classes:f}=t.config;for(let o=0;o<i;o=o+2){let a=c[o],b=c[o+1],d=Object.create(null);d.idx=t.folds.length;let x=a.classList.contains(f.initial),v=a.classList.contains(f.opened),g=a.classList.contains(f.disabled),h=b.classList.contains(f.expanded);a.ariaExpanded==="true"||v||h||x?(v?a.ariaExpanded="true":a.classList.add(f.opened),h||b.classList.add(f.expanded),g||a.classList.add(f.disabled),x||a.classList.remove(f.initial),a.ariaDisabled="true",d.expanded=!0,d.disabled=!0):a.ariaDisabled==="true"||g?(g?a.ariaDisabled="false":a.classList.add(f.disabled),b.classList.remove(f.expanded),a.classList.remove(f.opened),a.ariaExpanded="false",d.expanded=!1,d.disabled=!0):(d.expanded=!1,d.disabled=!1,a.ariaExpanded="false",a.ariaDisabled="false"),a.id&&(d.id=a.id),b.id&&(d.id=b.id),"id"in d||(d.id=`${t.id}F${d.idx}`,a.id=`B${d.id}`,b.id=`C${d.id}`),a.setAttribute("aria-controls",d.id),b.setAttribute("aria-labelledby",a.id),b.setAttribute("role","region"),d.btn=a,d.el=b,d.expanded&&(t.count=t.count+1,d.el.style.maxHeight=`${d.el.scrollHeight}px`),u(d)}let m=(o,a,b=!1)=>{if(typeof a=="number")return o.charCodeAt(0)===100?t.folds[a][o](b):t.folds[a][o]();if(typeof a=="string"){for(let d of t.folds)if(d.btn.dataset[`${t.config.schema}-fold`]===a)return o.charCodeAt(0)===100?d[o](b):d[o]()}throw new TypeError(`Fold does not exist: "${a}"`)};return t.on=s.on,t.off=s.off,t.collapse=o=>m("close",o),t.expand=o=>m("open",o),t.destroy=(o,a=!1)=>{if(typeof o=="undefined")for(let b of t.folds)b.destroy();else m("destroy",o,a);t.element.removeAttribute("aria-multiselectable"),s.emit("destroy",t),window.relapse.delete(e)},window.relapse.set(e,t),t}w.get=n=>n?window.relapse.get(n):window.relapse;var A=w;export{y as $events,A as default};
